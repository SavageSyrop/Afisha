# Afisha RUITLab Project

<img src="logo.png" alt="Afish Logo" width="50%" height="50%">  

## Функционал

Разработанная в рамках проекта система, обладает следующим функционалом:
1. Регистрация
2. Редактирование личной информации пользователей
3. Поиск мероприятий по типам и датам
4. Личные сообщения между пользователями
5. Возможность комментировать, оценивать и добавлять в фавориты мероприятия
6. Запросы выдачи роли и общие запросы в поддержку
7. Просмотр информации о пользователях и мероприятиях
8. Разделение уровня доступа к ресурсам в зависимости от роли (неавторизованный, авторизованный, организатор, администратор)
9. Функционал роли организатора позволяет создавать события и редактировать их.
10. Функционал роли администратор позволяет блокировать/разблокировать пользователей, удалять комменатрии и события, отвечать на заявки пользователей

Подробноее описание, а также другие функции, описанны в Swagger документации.

Диаграммы схем баз данных находятся в папке `diagrams`. 
Там же находится схема связи микросервисов в реализованной архитектуре и диаграммы последовательности регистрации пользователя и запроса создания мероприятия.

## Использованные технологии
Архитектура: Микросервисы с gRPC. (Обоснование: раньше писал только монолиты, решил попробовать архитектуру, которую используют в продакшене за счёт её масштабируемости)  
Основа: Spring Boot (Security,Web,Mail), Hibernate, RabbitMQ. (Обоснование: самый популярный фреймворк предоставляющий множество инструментов разработчику, в том числе поддержку Hibernate и RabbitMQ)  
База данных: PostgreSQL. (Обоснование: имел опыт с MySQL, SQLite и PostgreSQL, последний оказался самым удобным, например засчёт возможности создавать собственные Enum типы, которые занимают в разы меньше памяти чем varchar)  	
Миграции: Flyway (Обоснование: выбрал, так как использовал его раньше)  
Документация: Swagger (Обоснование: раньше использовал JavaDoc, но тут оказался более приветливый интерфейс)  
Дополнительно: авторизация через JWT токен, составление шаблонов писем через Velocity Engine. (Обоснование: выбрал, так как использовал их раньше)  	


## Установка
Для запуска системы необходимо установить `PostgreSQL` и `JDK 17` Для отправки запросов потребуется использовать `Postman`. 
Запуск системы осуществляется внутри `IntelliJ Idea` с помощью `Maven`.
При возникновении трудностей обратитесь к нулевому видео из раздела `Дополнительно`.

## Использование
0. Скачать репозиторий, разархивировать в удобном месте
1. Откройте папку с системой (Afisha) через `IntelliJ Idea`.
2. В верхнем меню выберите Run->Edit Configuration.
3. Установите `JDK 17` в качестве JDK.
4. Включите `Annotation Processing`.
5. Нажмите на значок `Maven` в правом углу экрана.
6. Выполните Afisha->Lifecycle->clean. Дождитесь окончания выполнения.
7. Выполните Afish->Lifecycle->compile. Дождитесь окончания выполнения.
8. Создайте в PGAdmin (на порту `5432`) базы данных с названиями adminDB,afishDB,eventDB,chatDB
9. Настройте блок `mail settings` в application.properties модуля user-service под свои данные.
10. Откройте модуль proto, перейдите в папку target->generated-sources->protobuf, нажмите правой кнокой мыши по папкам  grpc-java и java, выберите пункт Mark Directory as Generated Sources Root.
11. Запустите `Main` файлы в модулях admin-service, api-gateway, events-service, user-service, chat-service.
12. Дождитесь запуска `всех` модулей.
13. Можно отправлять запросы через `Postman`!

## Дополнительно
Не пропустите видео демонстрацию работы сервиса!
Файлы для тестов из видео лежат в папке `other`.

Видео:
0. Установка и использование: 
1. До регистрациии, регистрация, запросы в поддержку:
2. Запрос роли и создание события:
3. Поиск, комментирование, оценивание, добавление в фавориты и чаты:
4. Функции администратора:


Автор: Шевцов Ярослав
